<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>PanExpedia Narrative Visualization</title>

        <!-- Load in D3 -->
        <script src="https://d3js.org/d3.v6.js"></script>

        <!-- Script -->
        <script src="./js/visualization.js"></script>

        <!-- Load in custom CSS -->
        <!-- <link rel="stylesheet" type="text/css" href="./cs/style.css"> -->
    </head>
    <body onload="load1(); load2();">
        <h1 id="intro">PanExpedia Narrative Visualization for TOP 4 Most Visited Countries</h1>
        <div>
            <span class="italic">Wonjong (Jeff) Shin</span>
            <hr>
            <h2>
            Covid data ***ADD MORE TEXT***
            </h2>
            <ul>
                <li>
                    <a href="#one" class="contents">Covid Cases</a>
                </li>
                <li>
                    <a href="#two" class="contents">Covid Vaccination</a>
                </li>
                <li>
                    <a href="#three" class="contents">Covid Testing</a>
                </li>
            </ul>
            <hr>
        </div>

        <!-- scene1 -->
        <hr>
            <h2>Covid Cases</h2> 
            <p>Hover over the map to see the daily Covid Cases value </p>
            
            <!-- multi line graphs -->
            <div id="scene1"></div>
            
            <a href="#intro" class="back">Back to Top</a>
            <a href="#two" class="back">Next</a>
        <hr>

        <!-- scene2 -->
        <hr>
            <h2>Covid Vaccination Rate Comparison </h2>

            <!-- multi area graphs -->
            <div id="scene2"></div>

            <a href="#intro" class="back">Back to Top</a>
            <a href="#one" class="back">Previous</a>
            <a href="#three" class="back">Next</a>
        <hr>

        <!-- scene3 -->
        <hr>
            <h2>Covid Testing Rate</h2>

            

            <!-- Create a div where the graph will take place -->
            <div id="scene3"></div>

            <!-- A bit of CSS: change stroke color of circle on hover (white -> black) -->
            <style>
            .bubbles {
            stroke-width: 2px;
            stroke: white;
            }
            .bubbles:hover {
            stroke: black;
            }
            </style>


            <script>

            // set the dimensions and margins of the graph
            const margin = {top: 10, right: 100, bottom: 30, left: 300},
                                width = 1000 - margin.left - margin.right,
                                height = 500 - margin.top - margin.bottom;

            // append the svg object to the body of the page
            const scene3 = d3.select("#scene3")
            .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            //Read the data


            d3.csv("https://raw.githubusercontent.com/shinwj123/shinwj123.github.io/main/data/avgHosp_vs_avgDeath.csv", function(data) {

            // Add X axis
            const x = d3.scaleLinear()
                .domain([0, 260])
                .range([ 0, width ]);

            scene3.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            // Add label for X axis
            scene3.append("text")             
                .attr("transform",
                        "translate(" + (width/2) + " ," + 
                                        (height + margin.top + 20) + ")")
                .style("text-anchor", "middle")
                .text("Average COVID-19 Death Numbers in 2022");

            // Add Y axis
            const y = d3.scaleLinear()
                .domain([3600, 70000])
                .range([ height, 0]);

            scene3.append("g")
                .call(d3.axisLeft(y));

            // Add label for Y axis
            scene3.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 200 - margin.left)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Average COVID-19 Hospitalization Numbers in 2022");

            // Add the factor for the size of the plotted values
            const z = d3.scaleLinear()
                .domain([200000, 337000000])
                .range([ 4, 40]);

            // Add color in scatter plot based on the continent values
            const myColor = d3.scaleOrdinal()
                .domain(["Asia", "Europe", "Americas", "Africa", "Oceania"])
                .range(d3.schemeSet2);

            // Tooltip creation for mouse movement 
            const Tooltip = d3.select("#scene3")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "black")
                .style("border-radius", "5px")
                .style("padding", "10px")
                .style("color", "white")

            // functions for tooltip when the mouse hover / move / leave a cell
            const mouseover = function(d) {
                Tooltip
                .transition()
                .duration(200)

                Tooltip
                .style("opacity", 1)
                .html("Country: " + d.country + "  |  " 
                    + "Population: " + d.pop + "  |  " 
                    + "Death rate when hospitalized: " + d.avgDeath/d.avgHosp)            
                .style("left", (d3.mouse(this)[0]+30) + "px")
                .style("top", (d3.mouse(this)[1]+30) + "px")
            }

            const mousemove = function(d) {
                Tooltip
                .style("left", (d3.mouse(this)[0]+30) + "px")
                .style("top", (d3.mouse(this)[1]+30) + "px")
            }

            const mouseleave = function(d) {
                Tooltip
                .transition()
                .duration(200)
                .style("opacity", 0)
            }

            // Draw the Scattor plot
            scene3.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                    .attr("class", "bubbles")
                    .attr("cx", function (d) { return x(d.avgDeath); } )
                    .attr("cy", function (d) { return y(d.avgHosp); } )
                    .attr("r", function (d) { return z(d.pop); } )
                    .style("fill", function (d) { return myColor(d.continent); } )
                .on("mouseover", mouseover )
                .on("mousemove", mousemove )
                .on("mouseleave", mouseleave )
            
            }) //then(function(data) {
            </script>

            <a href="#intro" class="back">Back to Top</a>
            <a href="#two" class="back">Previous</a>
        <hr>

        

    </body>
</html>


